<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
<title>商品详情</title>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/swiper.min.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/common.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/style.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/buy_box.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/weui.css"/>
<link rel="stylesheet" type="text/css" href="__PUBLIC__/121/css/weui_reset.css"/>
<style>
.bottom-btn{position: fixed;left: 0;right: 0;bottom: 0;max-width: 640px;width: 100%;text-align: center;
height: 46px;line-height: 46px;margin: auto;background: #FE8425;color: #fff;background: #FE9422;font-size: .3rem;}
.swiper-pagination-bullet-active{background:#FE9422;}
.details{background: #fff;padding: .2rem;}
.details .goods_name{font-size: .3rem;color: #111;}
.details .goods_price{font-size: .3rem;color: #FF951D;margin: .1rem 0;}
.details .goods_price del{color: #666;font-size: .2rem;margin-left: .5rem;}
.img-block{width: 100%;display: block;}
.text{height: 40px;line-height: 40px;background: #fff;margin: 10px 0;padding-left: 10px;text-align: center;}
.spec span{padding:.15rem .2rem;margin-right: .2rem;border: 1px #666 solid;display: inline-block;color: #666;border-radius: 4px;}
.spec .option_active{color: #fff;background: #FE9422;border: 1px #FE9422 solid;}

._icon {display: inline-block;vertical-align: middle;
    width: 40px;
    height: 40px;
    background: url(__PUBLIC__/121/img/icons.png) center 0px no-repeat;
    background-size: 40px auto;
}
.icon_trans_ps {background-position: center -360px;}
.details-texts{background: #fff;line-height: 1.6;letter-spacing: 1px;text-indent: 24px;padding: .2rem;}
#logo{display: inline-block;vertical-align: middle;
	margin-right: 6px;
	background: url(__PUBLIC__/121/img/logo.jpg) no-repeat 0 0;
	width: 48px;
	height: 48px;
	background-size: 48px 48px;
}
.weui-cell_access:active{background: #fff}
.dispatch{background: #fff;padding: .1rem;margin-top: 10px;}
.dispatch span{vertical-align: middle;}
.weui-panel__ft{background: #fff;margin-top: 10px;}
.weui-cell{color: #000;border-bottom: 0;}
.details-texts img{display:block;width:100%;}
</style>
</head>
<body style="background:#f8f8f8;">
	<div class="app_container">
		<header>
			<div class="fixed header_inner">
				<div class="head">				
					<span class="left_arrow" onclick="javascript:history.go(-1)"><img src="__PUBLIC__/121/img/left-white.png"/></span>
					<span>商品详情</span>	
					<!--<span class="r-icon"><img src="user-__PUBLIC__/121/img/gwc_top.png"/></span>-->
					<div class="clear"></div>					
				</div>
			</div>
		</header>
		<!--商品轮播图-->
		<div id="banner">
			<div class="swiper-wrapper">
			    <volist name="good_info['pic']" id="vv">
				<if condition="$vv">
			    <div class="swiper-slide"><img src="{$vv}"/></div>
				</if>
				</volist>
			</div>
			<div class="pagination"></div>  
		</div>
		<div class="details">
			<p class="goods_name">{$good_info.good_name}</p>
			<p class="goods_price">价格：¥{$good_info.price}</del></p>
		</div>
		<div class="dispatch">
			<i class="_icon icon_trans_ps"></i>
			<span>商家配送</span>
		</div>
		<div class="weui-panel__ft">
			<div  onclick="show()" class="weui-cell weui-cell_access  weui-cell_link">
			    <div class="weui-cell__bd">请选择规格</div> 	
			    <span class="weui-cell__ft"></span>
			</div>    
		</div>
		
		<div class="weui-panel__ft">
			<div class="weui-cell  weui-cell_link">
				<div id="logo"></div>
			    <div class="weui-cell__bd">
			    	<div style="font-size:.3rem;">知酒堂</div>
			    	<div style="color: #24bf24;font-size:.25rem;">微信认证</div>
			    </div> 	
			    <span class="weui-cell__ft"></span>
			</div>    
		</div>
		<!--图文详情-->
		<div   style="padding-bottom:60px;">
			<div class="text">图文详情</div>
			<div class="details-texts">
				{$good_info.good_desc}
			</div>
			<!--<img class="img-block" src="__PUBLIC__/121/img/banner.png"/>-->
			<!--<img class="img-block" src="__PUBLIC__/121/img/img1.png"/>-->
		</div>
      	<div class="bottom-btn" onclick="show()">立即购买</div>
    
		<!--立即购买-->
		<div class="mask"></div>
	  	<div class="buy_box">
		    <div class="inner">
		      	<div class="goods">
		        	<img class="goods_img" src="{$good_info['pic1']}"/>
		        	<div class="goods_infor">
		          	<div class="goods_name">{$good_info.good_name}</div>
		          	<div class="sales">请选择规格</div>
		          	<div class="bottom_infor">
		            	<span class="goods_price">¥{$good_info.price}</span>
		            	<!--<span class="stock">库存:1000</span>-->
		          	</div>
		        	</div>
		        	<div onclick="cancel()">
		          	<img class="close_img" src="__PUBLIC__/121/img/icon_del.png"/>
		        	</div>
		      	</div> 
		      	<div class="number"> 
		      		<div class="tit">规格 : </div>
		      		<div class="spec">
		      			<volist name="spec" id="vv">
							<if condition="$vv['spec']">
		      					<span class="optiona" data-info="{$key}">{$vv.spec}</span>
							</if>
						</volist>
						<input type="hidden" id="spec" value="-1"/>
		      		</div>
		      	</div>
				<div class="number" >
					<div class="tit">数量 : </div>
					<div class="num_wrap">
						<span class="minus" id="min"></span>
						<input class="num" id="quantity" name="" type="text" value="1" disabled/>
						<span class="plus" id="add"></span>
					</div>
					<div class="clear"></div>
				</div>
					
		    </div>
		    
		    <div class="gotobuy" onclick="pay({$good_info['id']},{$order_type})" style="padding:.2rem;">立即购买</div>
	  	</div>
	</div>
</body>
<script src="__PUBLIC__/121/js/font.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/121/js/jquery-1.10.1.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/121/js/swiper.min.js" type="text/javascript" charset="utf-8"></script>
<script src="__PUBLIC__/admin/layer/layer.js"></script>
<script src="http://cdn.bootcss.com/blueimp-md5/1.1.0/js/md5.js"></script>
<script>

/*--------------------------------------*/
/*--------------------------------------*/
/*商品规格*/
	
	$('.optiona').click(function(){
		var classname =  $(this).attr('class');
		console.log(classname)
		if(classname.indexOf("option_active") > 0){
            $("#spec").val(-1);
			$(this).removeClass('option_active');
			return;
		}
		//用each 遍历 让所有的 tab 恢复默认
		$('.optiona').each(function(){
			//让所有的indextab遍历后恢复默认状态
			$(this).removeClass('option_active');
		});

		//现在正被点击的dom发生变化
		$(this).addClass('option_active');
		index = $(this).data('info')
		//异步得到价格

		var a = layer.load(2,{
		    shade:[0.6,"#000"]
		})
		$.ajax({
		   type:"post",
			url:"{:U('getSpecPrice')}",
			dataType:"json",
			data:{
		       good_id:{$good_info['id']},
				spec_index:index
			},
			success:function (data) {
				layer.close(a)
		       if(data.code == 1){
                   $("#spec").val(index);
				   $(".goods_price").text(data.info.price);
				   $(".sales").text(data.info.spec);
			   }else{
		           layer.msg(data.info)
			   }

            },
			error:function (data) {
				layer.close(a)
				layer.msg('网络错误，请稍后重试')
            }
		});
	})

/*--------------------------------------*/
/*--------------------------------------*/
/*商品轮播图*/
	var mySwiper1 = new Swiper('#banner',{
	  autoplay:3000,
	  visibilityFullFit : true,
	  loop:true,
	  pagination : '.pagination',
  });
  
/*****************************************/


/*--------------------------------------*/
/*--------------------------------------*/
/*立即购买*/
  	function show(){
		$(".buy_box").addClass('box_toggle');
		$(".mask").fadeIn(200);
	}
function cancel(){
    $(".buy_box").removeClass('box_toggle');
    $(".mask").fadeOut(200);
}
/*--------------------------------------*/
/*--------------------------------------*/
/*加减数量*/
	$(function(){
		//获得文本框对象
		var t = $("#quantity");	
		//数量增加操作
		$("#add").click(function(){		
			t.val(parseInt(t.val())+1)
			if (parseInt(t.val())!=1){
				$('#min').attr('disabled',false);
			}
		})	
		//数量减少操作
		$("#min").click(function(){
			if (parseInt(t.val())>1) {    //判断数量值大于1时才可以减少  
		        t.val(parseInt(t.val())-1)  
		        }
			else{
		        $("#min").attr("disabled","disabled")//当$("#min")为1时，$("#min")不可读状态  
		        }  
		})	
	})	
</script>
<script>
	//点击立即购买，判断是否选择属性，然后跳转到支付页面order_type = 1 从Game_game跳转过来的，表示游戏订单 其他的为0
    function pay(good_id,order_type){
        //判断有没有选择属性
		spec = $('#spec').val();
		if(spec == -1){
		    layer.msg('请选择是商品规格');return;
		}
		//得到购买的数量
		number = $("#quantity").val();
		if(number <= 0){
		    layer.msg('数量不正确');return;
		}
		if(order_type == 1){
		    //这个是游戏界面跑过来的，要进行限购20个
			if(number > 20){
			    layer.msg('单次最多购买20单');return;
			}
		}
		spec = parseInt(spec) + 1
		//通过ajax生成订单，然后通过订单id跳转
		var a = layer.load(2,{
		   shade:[0.6,"#000"]
		});
        $.ajax({
            type:"post",
            url:"{:U('createOrder')}",
            dataType:"json",
            data:{
				"good_id":good_id,
				'spec' : spec,
				"number":number,
				"order_type":order_type,
            },
            success:function (data) {
                if(data.code == 1){
                    location.href = "{:U('order')}?order_id=" + data.info;
                }else{
                    layer.close(a);
                    layer.msg(data.info)
                }

            },
            error:function (data) {
                layer.close(a);
                layer.msg('网络错误，请稍后重试')
            }
        });

    }
</script>
</html>
